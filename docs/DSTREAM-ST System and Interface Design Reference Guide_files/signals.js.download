var SignalsSDK;(()=>{"use strict";var e={};e.g=(()=>{if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}})(),(()=>{let t;var n="object",r=function(){},i="undefined"!=typeof process?process:{},o=(i.env&&i.env.NODE_ENV,"undefined"!=typeof document);function a(e,t){return t.charAt(0)[e]()+t.slice(1)}o&&window.location.hostname,null!=i.versions&&i.versions.node,"undefined"!=typeof Deno&&Deno.core,"object"==typeof self&&self.constructor&&self.constructor.name,o&&"nodejs"===window.name||"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom"));var s=a.bind(null,"toUpperCase"),l=a.bind(null,"toLowerCase");function u(e,t){void 0===t&&(t=!0);var n,r=null===e?s("null"):"object"==typeof e?d((n=e).constructor)?n.constructor.name:null:Object.prototype.toString.call(e).slice(8,-1);return t?l(r):r}function c(e,t){return typeof t===e}var d=c.bind(null,"function"),f=c.bind(null,"string"),h=c.bind(null,"undefined");function p(e,t){if("object"!=typeof t||null===t)return!1;if(t instanceof e)return!0;var n,r,i=u(new e(""));if((n=t)instanceof Error||f(n.message)&&n.constructor&&"number"===u(r=n.constructor.stackTraceLimit)&&!isNaN(r))for(;t;){if(u(t)===i)return!0;t=Object.getPrototypeOf(t)}return!1}function v(e,t){var n,r,i=e instanceof Element||e instanceof HTMLDocument;return i&&t?(n=e,void 0===(r=t)&&(r=""),n&&n.nodeName===r.toUpperCase()):i}function m(e){var t=[].slice.call(arguments,1);return function(){return e.apply(void 0,[].slice.call(arguments).concat(t))}}c.bind(null,"boolean"),c.bind(null,"symbol"),p.bind(null,TypeError),p.bind(null,SyntaxError),m(v,"form"),m(v,"button"),m(v,"input"),m(v,"select");var g="__global__",w=typeof self===n&&self.self===self&&self||typeof e.g===n&&e.g.global===e.g&&e.g||void 0;w[g]||(w[g]={});var y=function(){if(void 0!==y)return y;var e="cookiecookie";try{b(e,e),y=-1!==document.cookie.indexOf(e),y?b(e,"",-1):delete w[g][e]}catch(e){y=!1}return y}();function b(e,t,n,r,i,o){if("undefined"!=typeof window){var a=arguments.length>1;return!1===y&&(a?w[g][e]=t:w[g][e]),a?document.cookie=e+"="+encodeURIComponent(t)+(n?"; expires="+new Date(+new Date+1e3*n).toUTCString()+(r?"; path="+r:"")+(i?"; domain="+i:"")+(o?"; secure":""):""):decodeURIComponent((("; "+document.cookie).split("; "+e+"=")[1]||"").split(";")[0])}}var I={"[object HTMLCollection]":!0,"[object NodeList]":!0,"[object RadioNodeList]":!0},E={button:!0,fieldset:!0,reset:!0,submit:!0},S={checkbox:!0,radio:!0},T=/^\s+|\s+$/g,U=Array.prototype.slice,k=Object.prototype.toString,D="Invalid form";function A(e,t){var n=null,r=e.type;if("select-one"===r)return e.options.length&&(n=e.options[e.selectedIndex].value),n;if("select-multiple"===r){n=[];for(var i=0,o=e.options.length;i<o;i++)e.options[i].selected&&n.push(e.options[i].value);return 0===n.length&&(n=null),n}return"file"===r&&"files"in e?e.multiple?0===(n=U.call(e.files)).length&&(n=null):n=e.files[0]:S[r]?e.checked&&(n=e.value):n=t?e.value.replace(T,""):e.value,n}function _(e){return decodeURIComponent(e)}function F(e){return"__proto__"===e||"constructor"===e}var L="true",P="false";function j(e){if(!e)return"";var t=_(e);return"_null"===t?null:"_true"===t?L:"_false"===t?P:t===L||t!==P&&(0*t==0?+t:t)}var O=/.*/,V={"#":"hash","?":"search"},N=/^(https?)?(?:[\:\/]*)([a-z0-9\.-]*)(?:\:(\d+))?(\/[^?#]*)?(?:\?([^#]*))?(?:#(.*))?$/i;function R(e){var t,n;return h(e)&&o?window.location:(void 0===(t=e)&&(t=""),{href:(n=t.match(N))[0]||"",protocol:n[1]||"",hostname:n[2]||"",port:n[3]||"",pathname:n[4]||"",search:n[5]||"",hash:n[6]||""})}function x(e,t,n,r){var i=C(t||r,e);if(!0===n)return i;var o=function(e){void 0===e&&(e="");for(var t,n,r={},i=e.split("&");(t=i.shift())&&!F(n=(t=t.split("=")).shift());)r[n]=void 0!==r[n]?[].concat(r[n],j(t.shift())):j(t.shift());return r}(i);return n?o[n]:o}function C(e,t){var n=R(e)[V[t]];return n.charAt(0)===t?n.substring(1):n}function z(e,t,n){void 0===t&&(t=O);var r=R(n),i=e+C(n,e),a=t instanceof RegExp;if(!a&&-1===i.indexOf(t))return n;var s=RegExp("(\\&|\\"+e+")("+(a?t.source:"\\b"+t+"\\b")+')(=?[_A-Za-z0-9"+=.\\/\\-@%]+)?',"g"),l=i.replace(s,"").replace(/^&/,e),u=r.href.replace(i,l);if(o&&!n&&r.href!==u){var c=window.history;if(!c&&!c.replaceState)return;c.replaceState({},"",u)}return u}function M(e,t){var n,r=Object.create(null);t=function(e){if(!f(e))return!1;var t,n=e.match(N);return n&&(n[2].indexOf(".")>-1||(void 0===(t=n[2])&&(t=""),-1!==t.indexOf("localhost")||-1!==t.indexOf("127.0.0.1")))}(t)||!t?C(t,e):t;for(var i=/([^&=]+)=?([^&]*)/g;n=i.exec(t);){var o=_(n[1]),a=_(n[2]);"[]"===o.substring(o.length-2)?(r[o=o.substring(0,o.length-2)]||(r[o]=[])).push(a):r[o]=""===a||a}for(var s in r){var l=s.split("[");l.length>1&&(function(e,t,n){for(var r=t.length-1,i=0;i<r;++i){var o=t[i];if(F(o))break;o in e||(e[o]={}),e=e[o]}e[t[r]]=n}(r,l.map(function(e){return e.replace(/[?[\]\\ ]/g,"")}),r[s]),delete r[s])}return r}x.bind(null,"?"),x.bind(null,"?",null),z.bind(null,"?"),x.bind(null,"#"),x.bind(null,"#",null),z.bind(null,"#"),M.bind(null,"?"),M.bind(null,"#");let $={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},H=new Uint8Array(16),q=[];for(let e=0;e<256;++e)q.push((e+256).toString(16).slice(1));let B=function(e,n,r){if($.randomUUID&&!n&&!e)return $.randomUUID();let i=(e=e||{}).random||(e.rng||function(){if(!t&&!(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(H)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,n){r=r||0;for(let e=0;e<16;++e)n[r+e]=i[e];return n}return function(e,t=0){return q[e[t+0]]+q[e[t+1]]+q[e[t+2]]+q[e[t+3]]+"-"+q[e[t+4]]+q[e[t+5]]+"-"+q[e[t+6]]+q[e[t+7]]+"-"+q[e[t+8]]+q[e[t+9]]+"-"+q[e[t+10]]+q[e[t+11]]+q[e[t+12]]+q[e[t+13]]+q[e[t+14]]+q[e[t+15]]}(i)};var W={rE:"0.2.13"};function Z(e,t){for(let n of t)for(let t of e.keys())if(t.match(n)){let n=e.get(t);if("string"==typeof n&&""!==n)return n}}function K(e,t,n){for(let r of n)for(let n of e.querySelectorAll("input, textarea"))for(let e of t)if(n.hasAttribute(e)){let t=n.getAttribute(e);if(t?.match(r)){let e=n.value;if("string"==typeof e&&""!==e)return e}}}let J=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/,Q=e=>"nodeType"in e&&e.nodeType===Node.ELEMENT_NODE;function G(e){let t=(Q(e)&&"ownerDocument"in e?e.ownerDocument:window.document).defaultView;return e instanceof t.HTMLFormElement}class X{instance;constructor(e){this.instance=e;let t=(e,t,n)=>{e.querySelectorAll(t).forEach(n),new MutationObserver(e=>{for(let r of e)for(let e of r.addedNodes)Q(e)&&(e.matches(t)&&n(e),e.querySelectorAll(t).forEach(n))}).observe(e.body,{childList:!0,subtree:!0})},n=e=>{(function(e=document){return new Promise(t=>{"complete"===e.readyState||"interactive"===e.readyState?t():e.addEventListener("DOMContentLoaded",()=>t())})})(e).then(()=>t(e,"form",e=>e.addEventListener("submit",this.onSubmit.bind(this)))).catch(()=>{})};n(document),t(document,"iframe",e=>{let t=e.contentDocument;t&&n(t)})}onSubmit(e){if(null!=e.target&&G(e.target)){var t;let n=Z(new FormData(t=e.target),[/^email$/i,/email/i])??K(t,["autocomplete"],[/^email$/])??K(t,["placeholder"],[/email/i])??function(e,t){for(let n of t)for(let t of e.querySelectorAll("input, textarea")){let e=t.value;if("string"==typeof e&&e.match(n))return e}}(t,[J]),r=function(e){var t;let n=new FormData(e);return Z(n,[/^name$/i])??(""!==(t=[K(e,["autocomplete"],[/^given-name$/])??Z(n,[/first.*name/i,/fname/i,/given.*name/i])??K(e,["placeholder"],[/first.*name/i,/given.*name/i]),K(e,["autocomplete"],[/^family-name$/])??Z(n,[/last.*name/i,/lname/i,/surname/i])??K(e,["placeholder"],[/last.*name/i,/surname/i])].filter(e=>null!=e).join(" "))?t:null)??K(e,["autocomplete"],[/^name$/])??K(e,["placeholder"],[/name/i])}(e.target);this.instance.form({...null!=n?{email:n}:{},...null!=r?{name:r}:{}})}}}var Y="EventListener";function ee(e){return function(t,n,i,a){var s=i||r,l=a||!1;if(!o)return s;var u=et(n),c=et(t,!0);if(!c.length)throw Error("noElements");if(!u.length)throw Error("noEvent");var d=[];return function e(t){t&&(d=[]);for(var n=t?"add"+Y:"remove"+Y,r=0;r<c.length;r++){var i=c[r];d[r]=t?l&&l.once?function(e,t){var n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}}(s):s:d[r]||s;for(var o=0;o<u.length;o++)i[n]?i["on"+u[o]]=t?d[r]:null:i[n](u[o],d[r],l)}return e.bind(null,!t)}(e)}}function et(e,t){if(f(e))return t?et(document.querySelectorAll(e)):e.split(e.indexOf(",")>-1?",":" ").map(function(e){return e.trim()});if(NodeList.prototype.isPrototypeOf(e)){for(var n,r=[],i=e.length>>>0;i--;)r[i]=e[i];return r}var o=(n=e)?"array"===u(n)?n:[n]:[];return t?o.map(function(e){return f(e)?et(e,!0):e}).flat():o}var en=ee("Event");function er(e,t){var n,r;return o&&d(window[e])?(n=window[e],void 0===(r=window)&&(r=null),d(n)?function(){n.apply(r,arguments),t.apply(r,arguments)}:t):window[e]=t}ee(),er.bind(null,"onerror"),er.bind(null,"onload");var ei="undefined"==typeof window,eo="hidden",ea=["mousemove","mousedown","touchmove","touchstart","touchend","keydown"];function es(e,t){return t?0:Math.round((new Date-e)/1e3)}class el{currentUrl;instance;currentFocusTime;aggregateFocusTime;activityTracker;heartbeatInterval;idleTimeout;constructor(e,{heartbeatInterval:t,idleTimeout:n=15}={}){this.instance=e,this.currentUrl=null,this.currentFocusTime=0,this.aggregateFocusTime=0,this.heartbeatInterval=t,this.idleTimeout=n;let r=history.pushState;history.pushState=(...e)=>{r.apply(history,e),this.onPageChange()};let i=history.replaceState;history.replaceState=(...e)=>{i.apply(history,e),this.onReplaceState()},window.addEventListener("popstate",()=>this.onPageChange()),this.activityTracker=function(e){var t,n,r=e.onIdle,i=e.onWakeUp,o=e.onHeartbeat,a=e.timeout,s=void 0===a?1e4:a,l=e.throttle,u=!1,c=!1,d=new Date,f=function(){return clearTimeout(t)};function h(e){f(),o&&!u&&o(es(d),e),i&&u&&(u=!1,i(es(n),e),d=new Date),t=setTimeout(function(){u=!0,r&&(n=new Date,r(es(d),e))},s)}var p=function(e,t){void 0===t&&(t={});var n=function(e,t){var n=this,r=!1;return function(i){r||(e.call(n,i),r=!0,setTimeout(function(){return r=!1},t))}}(e,t.throttle||1e4),r=[];function i(){return r=[function(e){if(ei)return!1;var t=ei||eo in document?eo:["webkit","moz","ms","o"].reduce(function(e,t){var n=t+"Hidden";return!e&&n in document?n:e},null),n="".concat(t.replace(/[H|h]idden/,""),"visibilitychange"),r=function(){return e(!!document[t])},i=function(){return document.addEventListener(n,r)};return i(),function(){return document.removeEventListener(n,r),i}}(function(e){e||n({type:"tabVisible"})})].concat(ea.map(function(e){return en(document,e,n)})).concat(en(window,"load",n)).concat(en(window,"scroll",n,{capture:!0,passive:!0})),o}function o(){r.map(function(e){return e()})}return i(),function(){return o(),i}}(h,{throttle:void 0===l?2e3:l});return{disable:function(){c=!0,u=!1,f();var e=p();return function(){return c=!1,d=new Date,h({type:"load"}),e()}},getStatus:function(){return{isIdle:u,isDisabled:c,active:u?0:es(d,c),idle:u?es(n,c):0}}}}({onIdle:e=>{this.onPageFocus(e)},onHeartbeat:null!=this.heartbeatInterval?e=>{this.onPageFocus(e)}:void 0,onWakeUp:()=>{this.aggregateFocusTime+=this.currentFocusTime,this.currentFocusTime=0},timeout:1e3*this.idleTimeout,throttle:null!=this.heartbeatInterval?1e3*this.heartbeatInterval:void 0}),window.addEventListener("beforeunload",()=>{this.onLeavingPageFocus()}),this.onPageChange()}resetActivityTracker(){this.aggregateFocusTime=0,this.currentFocusTime=0,this.activityTracker.disable()()}onPageFocus(e){e>=0&&e<=525?(this.currentFocusTime=e,this.instance.pageFocus(this.aggregateFocusTime+this.currentFocusTime)):(this.instance.pageFocus(this.aggregateFocusTime),this.resetActivityTracker())}onLeavingPageFocus(){if(this.currentUrl){let e=this.activityTracker.getStatus();e.isIdle||this.onPageFocus(e.active)}}onPageChange(){this.onLeavingPageFocus(),this.currentUrl=new URL(window.location.href),this.instance.page(),this.resetActivityTracker()}onReplaceState(){let e=new URL(window.location.href);(null==this.currentUrl||this.currentUrl.hostname!==e.hostname||this.currentUrl.pathname!==e.pathname||this.currentUrl.search!==e.search)&&this.onPageChange()}}let eu={USER_ID:"signals-sdk-user-id",SESSION_ID:"signals-sdk-session-id"},ec={EMAIL:"cr_email",EMAIL_BASE64:"cr_e",UTM_ID:"utm_id"};function ed(e){let t=document.createElement("input");if(t.type="email",t.required=!0,t.value=e,!("function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e)))return!1;let n=e.split("@")[0];return!(null==n||/\*{3,}$/.test(n))}function ef(e,t,n=["string"]){return Object.fromEntries(Object.entries(e).filter(([e,r])=>t.includes(e)&&n.includes(typeof r)))}class eh{siteId;userId;sessionId;apiHost;pageTracker=null;formTracker=null;static version=W.rE;lastPageViewEvent=null;constructor(e,{apiHost:t="https://api.cr-relay.com",autoTracking:n=!0}={}){this.siteId=e,this.apiHost=t,this.userId=this.initializeUserId(),this.sessionId=this.initializeSessionId();try{this.identifyWithQueryParams()}catch(e){console.error("Failed to identify the visitor with query params")}n&&(this.pageTracker=new el(this),this.formTracker=new X(this))}initializeStoredId(e,t,n){let r=b(e),i=""!==r?r:t;return b(e,i,n,"/","."+R(window.location.href).hostname.split(".").slice(-2).join("."),!1),i}initializeSessionId(){return this.initializeStoredId(eu.SESSION_ID,B(),1800)}initializeUserId(){return this.initializeStoredId(eu.USER_ID,B(),31536e3)}identifyWithQueryParams(){let e,t=new URLSearchParams(window.location.search),n=t.get(ec.EMAIL),r=t.get(ec.EMAIL_BASE64),i=t.get(ec.UTM_ID),o=t=>{try{let n=atob(t);ed(n)&&(e=n)}catch(e){}};null!=n&&ed(n)?e=n:null!=r?o(r):null!=i&&o(i),null!=e&&this.identify({email:e})}traceApiUrl(e){return new URL(`v1/site/${e}/batch`,this.apiHost)}async sendEvent(e){let t=this.traceApiUrl(this.siteId).toString(),n=JSON.stringify([e]);try{if(navigator.sendBeacon&&"function"==typeof navigator.sendBeacon&&navigator.sendBeacon(t,n))return;await fetch(t,{method:"POST",body:n,keepalive:!0,headers:{"Content-Type":"application/json"}})}catch(e){console.warn("Failed to send web visit event:",e)}}page(e){let t={eventType:"page_view",url:"string"==typeof e?e:e?.url??window.location.href,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,pageViewId:B()};this.lastPageViewEvent=t,this.sendEvent(t)}pageFocus(e){if(null==this.lastPageViewEvent)return;let t={eventType:"page_focus",pageViewId:this.lastPageViewEvent.pageViewId,focusTime:e,url:this.lastPageViewEvent.url,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version};this.sendEvent(t)}identify(e){let t={eventType:"identity",userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,...ef(e,["email","name"])};this.sendEvent(t)}identifyWithVector(){if(void 0===window.vector)return;let e=JSON.stringify({userId:this.userId});window.vector.partnerId=e,window.vector.identify(e)}form(e){let t=G(e)?function(e,t){if(void 0===t&&(t={trim:!1}),!e||!e.elements)throw Error(D);for(var n,r={},i=[],o={},a=0,s=e.elements.length;a<s;a++){var l=e.elements[a];E[l.type]||l.disabled||(n=l.name||l.id)&&!o[n]&&(i.push(n),o[n]=!0)}for(var u=0,c=i.length;u<c;u++){var d=function(e,t,n){if(void 0===n&&(n={trim:!1}),!e)throw Error(D);if(!t&&"[object String]"!==k.call(t))throw Error("Field name is required by getInputData");var r=e.elements[t];if(!r||r.disabled)return null;if(!I[k.call(r)])return A(r,n.trim);for(var i=[],o=!0,a=0,s=r.length;a<s;a++)if(!r[a].disabled){o&&"radio"!==r[a].type&&(o=!1);var l=A(r[a],n.trim);null!=l&&(i=i.concat(l))}return o&&1===i.length?i[0]:i.length>0?i:null}(e,n=i[u],t);null!=d&&(r[n]=d)}return r}(e):e,n={eventType:"form",url:window.location.href,userId:this.userId,sessionId:this.sessionId,sdkVersion:eh.version,...ef(t,["email","name"])};this.sendEvent(n)}}!function(e,t){if("string"!=typeof e||""===e)throw Error("siteId is required");if(void 0!==window.signals&&window.signals instanceof eh)throw Error("SignalsSDK already loaded");null==t&&(t={});let n=new eh(e,t);if(Array.isArray(window.signals))for(let[e,t]of window.signals)try{n[e](...t)}catch(t){console.warn(`Error calling ${e}`,t)}window.signals=n}(null!=window.signals&&"_siteId"in window.signals?window.signals._siteId:function(){let e=document.currentScript?.getAttribute("src");return null!=e?e.split("/").at(-2):""}(),null!=window.signals&&"_opts"in window.signals?window.signals._opts:void 0)})(),SignalsSDK={}})();